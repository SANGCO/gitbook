

## 1장. 쿠버네티스 소개



#### 1.1 컨테이너

- 컨테이너에는 호스트 운영체제 위에 도커 또 그 바로 위에 앱(애플리케이션)이 위치
  - 반면 가상 머신은 하이퍼바이저 위의 가상 머신 마다 게스트 운영체제가 있고 그 위에 앱이 위치
  - 그림 1-1 컨테이너와 가상 머신의 차이 참고
- 도커를 설치한 호스트에 해당 컨테이너 이미지를 다운로드 해서 컨테이너를 실행
  - 그림 1-2 도커 데몬은 호스트에 설치한 도커를 얘기하는 건가?
- 컨테이너가 등장하기 전에는 소스트에도 개발 환경 세팅을 해워야 했고 이 과정에 여러 가지 장애 요소가 많이 발생했었단다.
  - 컨테이너와 오케스트레이션 시스템을 사용하면 앱을 배포하고 관리하기 더 편하고 강력해진단다.



#### 1.2 컨테이너 오케스트레이션 시스템

- 컨테이너 오케스트레이션 시스템으로 서버들을 클러스터로 구성하면, 서버 1대든 100대든 컨테이너를 한 번의 명령으로 자동 배포할 수 있다.
  - 그림 1-3 기존 컨테이너 기반 상용 서비스의 여러 가지 수동 제어 참고
  - 서버들로 클러스터를 구성한다? 자세한건 뒤에 나오겠지
- 클러스터 일부에서 장애 발생하면 오케스트레이션 시스템이 알아서 장애가 발생한 서버에 있는 컨테이너들을 정상 운영 중인 다른 서버로 옮겨서 실행시킨다.
  - 그림 1-4 쿠버네티스의 구조로 보는 컨테이너 오케스트레이션 시스템 참고
    - 마스터, 인그레스 이런 용어 뒤에 나올 듯.
  - 클러스터 내부에서 장애가 발생한 서버로 가는걸 정상 운영 중인 서버로 보내는건가?
    - 이것도 뒤에 공부를해야 이해가 될 듯.



#### 1.3 쿠버네티스

- 쿠버네티스는 배의 조타수라는 그리스 단어에서 유래했다.
- 2014년 구글 안에서 사용하던 컨테이너 오케스트레이션 시스템 보그(borg)를 오픈 소스 소프트웨어로 공개한 것
- 쿠버네티스
  - Kubernetes
  - k8s
    - k와 s사이의 글자 개수가 8개라서



#### 1.4 쿠버네티스의 특징

- 쿠버네티스가 많은 인기를 얻은 이유
  - 사용하기 간편한 선언적 API
  - 처음 사용할 때의 손쉬운 접근성
  - 도움을 받을 수 있는 강력한 커뮤니티



##### 1.4.1 선언적 API

- 쿠버네티스의 가장 큰 설계 원칙은 API가 '선언적'이라는 것이다.
  - 컨테이너가 어떤 상태이길 원하는지 쿠버네티스에 설정하면 지속적으로 컨테이너의 상태를 확인하고 설정한 상태가 아니라면 설정한 상태로 맞춘다는 개념
- 선언적? 
  - 선언형 프로그램
    - 프로그램이 어떤 방법으로 해야 하는지를 나타내기보다 무엇과 같은지를 설명하는 경우에 '선언형'이라고 한다.
      - 웹 페이지는 선언형인데 웹페이지는 제목, 글꼴, 본문, 그림과 같이 '무엇'이 나타나야하는지를 묘사하는 것이지 '어떤 방법으로' 컴퓨터 화면에 페이지를 나타내야 하는지를 묘사하는 것이 아니기 때문
    - C, 자바와 같은 명령형 프로그래밍 언어와는 접근방식이 다르다.
    - 명령형 프로그램은 알고리즘을 명시하고 목표는 명시하지 않는 데 반해 선언형 프로그램은 목표를 명시하고 알고리즘을 명시하지 않다.
  - 쿠버테티스의 API는 선언적이다.
    - 구체적으로 어떻게 할지 알고리즘을 명시하지는 않고 자신이 원하는 컨테이너의 상태를 설정하면(선언하면) 그 상태가 아닐 때 설정했던 상태로 맞춰준다.
      - 선언적이라는 표현을 쓰는 이유를 이렇게 이해하고 넘어가도 되려나



##### 1.4.2 워크로드 분리

- 워크로드
  - 워크로드, 작업부하, 업무부하
  - 작업이 주는 스트레스의 양
  - 작업 시스템에 있어서 사람의 생리적·심리적 상태를 혼란시키도록 작용하는 외적조건이나 요구의 총량
  - 시스템의 사용자 및 애플리케이션들이 발생시키는 전체 처리요구량
- 분산 시스템을 개발할 때는 분산된 프로세스 각각이 잘 실행이 되는지, 이상이 생겼을 때는 어떻게 처리해야 하는지 등 시스템 안정성에 관한 고민을 많이 하게 된다.
  - 분산된 프로세스
    - 같은 서버를 두개 띄우고 각각 요청을 받으면 프로세스가 시작된다.
      - 이렇게 프로세스가 분산 되었다는 걸까?
  - 이때 쿠버네티스는 운영체제처럼 분산된 프로세스의 관리를 추상화하는 레이어가 되므로 시스템 운영에 관한 고민을 덜어 준다.
    - 운영체제처럼 분산된 프로세스의 관리
      - 쿠버네티스를 통해 여러 서버를 띄우고 각각의 서버들은 요청을 받아 프로세스를 일으킨다.
        - 프로세스들을 쿠버네티스가 안정적으로 관리를 하기때문에 운영체제에 비유한거 같다.
          - 최근에는 쿠버네티스를 클라우드의 리눅스라고 말하기도 한단다.



##### 1.4.3 어디서나 실행 가능

- 쿠버네티스가 지금처럼 인기를 얻게 된 주요 원인 중 하나는 어디서나 실행할 수 있다는 점이다.
  - 개인 컴퓨터에 설치해서 사용 가능
  - 여러 대 서버에 설치해서 사용 가능
  - 퍼블릭 클라우드에서도 가능
  - 단순한 테스트라면 쿠버네티스 설치 없이 웹에서도 사용 가능



##### 1.4.4 커뮤니티

- 여기저기 도움 받을 수 있는데가 많네.




## 2장. 쿠버네티스 설치하기



#### 2.1 설치 없이 쿠버네티스 사용하기

- 쿠버네티스는 별도로 설치하지 않고 웹 브라우저에서 사용해볼 수 있단다.



##### 2.1.1 카타코다 쿠버네티스 플레이그라운드

- [카타코다 쿠버네티스 플레이그라운드](https://www.katacoda.com/courses/kubernetes/playground)



##### 2.1.2 Play with Kubernetes

- [Play with Kubernetes](https://labs.play-with-k8s.com/)



#### 2.2 도커 데스크톱을 이용한 쿠버네티스 설치

- 컴퓨터에 쿠버네티스를 설치하는 방법 두 가지
  - 미니큐브를 이용하는 방법
  - 도커허브의 도커 데스크톱에서 제공하는 쿠버네티스를 사용하는 방법
    - 이 책에서는 설정이 더 간편해서 이걸 쓸거라고



##### 2.2.1 윈도우에 도커와 쿠버네티스 설치하기



##### 2.2.2 macOS에 도커와 쿠버네티스 설치하기

- 기존에 도커 깔아서 쓰고 있어서 쿠버네티스 설치는 간단하군.
  - Preference
    - Kubernetes 탭
      - Enable Kubernetes 선택
      -  Deploy Docker Stacks to Kubernetes by default 선택
      - Apply & Restart 클릭
  - `kubectl version` 명령어로 설치 확인



#### 2.3 클라우드 서비스에서 제공하는 쿠버네티스 도구

- 쿠버네티스를 제대로 활용하려면 여러 대 서버를 클러스터로 구성해 사용해야 한다.
- 쿠버네티스 클러스터를 구성하는 건 쉽지 않은 작업이고 구성 이후에도 증설, 업그레이드, 백업, 복구 등 지속해서 클러스터를 관리해야 하는 어려움이 있다.
  - 쿠버네티스 클러스터를 구성하고 관리하는 가장 간단한 방법은 각 클라우드 서비스에서 제공하는 관리형 쿠버네티스 도구를 이용하는 것.



##### 2.3.1 구글 쿠버네티스 엔진

- 쿠버네티스와 가장 잘 호환되는 클라우드 서비스는 아무래도 쿠버네티스를 처음 개발해서 오픈소스로 만든 구글 클라우드 플랫폼이다.
  - 구글 쿠버네티스 엔진(GKE)이라는 관리형 쿠버네티스 클러스터를 제공한다.



##### 2.3.2 아마존 쿠버네티스 일래스틱 컨테이너 서비스

- 아마존 웹 서비스는 아마존 쿠버네티스 일래스틱 컨테이너 서비스(EKS)라는 관리형 쿠버네티스 도구를 제공



##### 2.3.3 애저 쿠버네티스 서비스

- 마이크로소프트는 애저 쿠버네티스 서비스(AKS)가 있다.



#### 2.4 쿠버네티스 클러스터를 직접 구성하는 도구

- 쿠버네티스 클러스터를 직접 구성하거나, 규칙 준수 이슈를 해결할 때 활용하는 대표적인 도구인 Kubeadm, Kubespray



##### 2.4.1 Kubeadm

- 큐베어드민?

- 쿠버네티스에서 공식 제공하는 클러스터 생성/관리 도구 
  - 여러 대 서버를 쿠버네티스 클러스터로 손쉽게 구성할 수 있다.
  - 로드밸런서 사용
    - 그림 2-20 Kubeadm에서 제공하는 클러스터 고가용성 구조 참고



##### 2.4.2 Kubespray

- 큐베스프레이?
- 상용 서비스에 적합한 보안성과 고가용성이 있는 쿠버네티스 클러스터를 배포하는 오픈 소스 프로젝트
  - 별도의 로드밸런서를 사용하지 않고 노드 각각의 nginx가 리버스 프록시로 실행된다.
    - 그래서 쿠버네티스의 컴포넌트들은 직접 마스터 노드와 통신하지 않고 자신의 서버 안 nginx와 통신한다.	
      - 그림 2-21 Kubespray에서 제공하는 클러스터 고가용성 구조
- 마스터 노드, 워커 노드, 그림 2-22 까우란 같이 보기 
- 실습 인프라 구성 부분
  - 일단 이부분은 스킵



## 3장. 쿠버네티스로 컨테이너 실행하기



#### 3.1 kubectl



##### 3.1.1 설치



##### 3.1.2 기본 사용법



##### 3.1.3 POSIX/GNU 스타일의 명령 작성 규칙



##### 3.1.4 플래그



##### 3.1.5 kubeconfig 환경 변수



##### 3.1.6 자동 완성



##### 3.1.7 다양한 사용 예



#### 3.2 디플로이먼트를 이용해 컨테이너 실행하기



##### 3.2.1 kubectl run으로 컨테이너 실행하기



##### 3.2.2 템플릿으로 컨테이너 실행하기



#### 3.3 클러스터 외부에서 클러스터 안 앱에 접근하기